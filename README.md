# build_image.py
<b>build_image.py</b> would be invoked when [1]. making system image and [2]. adding the system image to target files: <br>
    <img src="https://github.com/YuwenLee/Android_P/blob/master/makefile_add-img-to-target-files.png" width=640/> <br>
It takes at least 3 arguments (input_dir, prop-dictionary, and output) and then invokes mkuserimg_mke2fs.sh to generate the output image.
<pre>
  build_image.py \
      out/target/product/abc/system \
      system_image_info.txt \
      obj/PACKING/targetfiles/system.img \
      out/target/product/htc/system
</pre>
## [1]. input_dir
The source of the file system. Take the image of system as example, the input directory looks like
Note:
The symbolic links product and vendor are created in the procedure of making $(BUILT_SYSTEMIMAGE)
## [2]. prop-dictionary
A lookup table used to generate the command to make the image. In the makefile (LINUX/android/build/core/Makefile), the table is generated by generate-userimage-prop-dictionary:
<pre>
$(if $(BOARD_SYSTEMIMAGE_PARTITION_SIZE), \
   $(hide) echo "system_size=$(BOARD_SYSTEMIMAGE_PARTITION_SIZE)" \
   >> $(1))
</pre>
A complete dictionary looks like
## [3]. out_file
Path of the output image file. This parameter is used as the 2nd argument passed to the build_command (ie mkuserimg_mke2fs.sh) :
## [4]. target_out (optional)
According the comment in the script, this parameter is "the path of the product out directory to read device specific FS config files".
In the script, this parameter is used as -D option of the build_command. The arguments to the build command (mkuserimg.sh) are:
When building the system.img, build_image.py uses the yellow parts of the above prop-dictionary to generate the command:
